{{ form_start(post_form, {'attr': { 'class': '[ oocss-form oocss-form__d__post ]'}})}}
    <div class="[ oocss-form-row ]">
        <div class="[ oocss-form-label ]">{{ form_label(post_form.title) }}</div>
        <div class="[ oocss-form-error ]">{{ form_errors(post_form.title) }}</div>
        <div class="[ oocss-form-widget ]">{{ form_widget(post_form.title, {'attr': {'class': '[ oocss-form-input oocss-form-text oocss-full-container-width ] titre' }}) }}</div>
    </div>
    
    <div class="[ oocss-form-row ]">
        <div class="[ oocss-form-label ]">{{ form_label(post_form.content) }}</div>
        <div class="[ oocss-form-error ]">{{ form_errors(post_form.content) }}</div>
        <div class="[ oocss-form-widget oocss-full-container-width ]">{{ form_widget(post_form.content, {'attr': {'class': '[ oocss-form-input oocss-form-ckeditor ] content'}}) }}</div>
    </div>
    
    <div class="[ oocss-form-row ]">
        <div class="[ oocss-form-label ]">{{ form_label(post_form.date_publication) }}</div>
        <div class="[ oocss-form-error ]">{{ form_errors(post_form.date_publication) }}</div>
        <div class="[ oocss-form-widget ]">{{ form_widget(post_form.date_publication, {'attr': {'class': '[ oocss-form-input oocss-form-date ] date-publication'}}) }}</div>
    </div>
    
    <div class="[ oocss-form-row ]">
        <div class="[ oocss-form-label ]">{{ form_label(post_form.date_peremption) }}</div>
        <div class="[ oocss-form-error ]">{{ form_errors(post_form.date_peremption) }}</div>
        <div class="[ oocss-form-widget ]">{{ form_widget(post_form.date_peremption, {'attr': {'class': '[ oocss-form-input oocss-form-date ] date-peremption'}}) }}</div>
    </div>

    <div class="[ oocss-form-row ]">
        <div class="[ oocss-form-label ]">{{ form_label(post_form.visibilite) }}</div>
        <div class="[ oocss-form-error ]">{{ form_errors(post_form.visibilite) }}</div>
        <div class="[ oocss-form-widget ]">{{ form_widget(post_form.visibilite, {'attr': {'class': '[ oocss-form-input oocss-form-radio-on-off ] visibilite'}}) }}</div>
    </div>

    <div class="[ oocss-form-row ]">
       {# <div class="oocs-form-label">{{ form_label(post_form.collections_select) }}</div>
        <div class="oocss-form-error">{{ form_errors(post_form.collections_select) }}</div>
        <div class="oocss-form-widget">{{ form_widget(post_form.collections_select) }}</div> #}
        
        <div class="[ oocss-form-error ]">{{ form_errors(post_form.collections_add) }}</div>
        <div class="[ oocss-form-widget ]">
            <div  data-my-label="Collection n°" class="[ oocss-js-dynamic-template ]" data-prototype="{{ form_widget(post_form.collections_add.vars.prototype.name, {'attr':{'class':'[ oocss-form-input-button ]', 'placeholder': 'saisissez un nom pour la nouvelle collection'}})|e('html_attr') }} {{ form_widget(post_form.collections_add.vars.prototype.description, {'attr':{'class':'[ oocss-form-input ]', 'placeholder': 'saisissez une description pour la nouvelle collection'}})|e('html_attr') }}">
            </div>
            <button class="[ oocss-button oocss-button-rounded oocss-js-dynamic-button ]">+</button>
        </div>
    </div>

    <div class="[ oocss-form-row ]">
        <div class="[ oocss-form-widget ]">{{ form_widget(post_form.submit, {'attr': {'class': '[ oocss-form-input oocss-form-submit oocss-button ]'}, 'label': submit_label }) }}</div>
    </div>

    {{ form_widget(post_form._token) }}
{{ form_end(post_form, {'render_rest': false}) }}

<!-- on ajoute le script pour le traitement dynamique du champ collections -->
<script type="text/javascript">
    const dynamicField = document.querySelector('.oocss-js-dynamic-template');
    const addBtn = document.querySelector('.oocss-js-dynamic-button');
    console.log(dynamicField);
    //console.log(addBtn);

    //on définit un compteur unique pour nommer les champs qu'on va ajouter dynamiquement
    var index = 0;

    function addField(dynamicField){
      // Dans le contenu de l'attribut « data-prototype », on remplace :
      // - le texte "__name__label__" qu'il contient par le label du champ
      // - le texte "__name__" qu'il contient par le numéro du champ
        var dataPrototype = dynamicField.getAttribute('data-prototype');
        //var dataMyLabel = dynamicField.getAttribute('data-my-label');

        console.log(dataPrototype);
        //var label = dataPrototype.replace('/__name__label__/g', dataMyLabel + (index+1));
        var field = dataPrototype.replace(/__name__/g, index.toString());
        console.log(field);

        //on ajoute le champ modifié à la fin de la balise
        var newDiv = document.createElement('div');
        newDiv.innerHTML += field;

        dynamicField.appendChild(newDiv);
        //on incrémente le compteur de champs dynamiques
        index++;
    }

    addBtn.addEventListener('click', function(e){
        //on désactive la cible du "lien"
        e.preventDefault();
        //on ajoute un nouveau champ
        addField(dynamicField);
    });
</script>